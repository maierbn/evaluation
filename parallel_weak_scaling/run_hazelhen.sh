#!/bin/bash 
# weak scaling
date
module add shared openmpi

echo "OPENCMISS_REL_DIR=$OPENCMISS_REL_DIR, OPENCMISS_INPUT_DIR=$OPENCMISS_INPUT_DIR"

. /etc/profile.d/modules.sh
. ~/.bashrc


while true; do
  aprun -n 1 $OPENCMISS_REL_DIR/cuboid $OPENCMISS_INPUT_DIR 3 8 1 1
  aprun -n 2 $OPENCMISS_REL_DIR/cuboid $OPENCMISS_INPUT_DIR 3 8 2 1
  aprun -n 4 $OPENCMISS_REL_DIR/cuboid $OPENCMISS_INPUT_DIR 3 16 2 1
  aprun -n 8 $OPENCMISS_REL_DIR/cuboid $OPENCMISS_INPUT_DIR 6 16 2 1
  aprun -n 12 $OPENCMISS_REL_DIR/cuboid $OPENCMISS_INPUT_DIR 6 16 3 1
  aprun -n 16 $OPENCMISS_REL_DIR/cuboid $OPENCMISS_INPUT_DIR 6 16 4 1
  aprun -n 24 $OPENCMISS_REL_DIR/cuboid $OPENCMISS_INPUT_DIR 6 24 4 1
  aprun -n 32 $OPENCMISS_REL_DIR/cuboid $OPENCMISS_INPUT_DIR 6 32 4 1
  aprun -n 64 $OPENCMISS_REL_DIR/cuboid $OPENCMISS_INPUT_DIR 12 32 4 1
  aprun -n 96 $OPENCMISS_REL_DIR/cuboid $OPENCMISS_INPUT_DIR 12 32 6 1
  aprun -n 128 $OPENCMISS_REL_DIR/cuboid $OPENCMISS_INPUT_DIR 12 32 8 1
  aprun -n 192 $OPENCMISS_REL_DIR/cuboid $OPENCMISS_INPUT_DIR 18 32 8 1
  aprun -n 256 $OPENCMISS_REL_DIR/cuboid $OPENCMISS_INPUT_DIR 24 32 8 1
done
